## linuxtoys function library
source /etc/os-release

# sudo request
sudo_rq () { 
    # Get password from zenity
    PASSWD=$(zenity --password --title="Autenticação requerida") || fatal "Password dialog was cancelled or failed."

    if echo "$PASSWD" | timeout 5 sudo -S -p "" true 2>/dev/null; then
        sudo -v 2>/dev/null
        export PASSWD   # torna a senha disponível para subprocessos do script
        return 0
    else
        unset PASSWD
        fatal "Wrong password. Do you have sudo?"
    fi
}

# zenity libs
zeninf () {
    zenity --info --text "$1" --width 360 --height 300
    return 0
}
zenwrn () {
    zenity --warning --text "$1" --width 360 --height 300
    return 0
}

## error handlers
fatal() {
    zenity --error --title "Fatal Error" --text "$1" --width 360 --height 300
    exit 1
}
nonfatal() {
    zenity --error --title "Error" --text "$1" --width 360 --height 300
    return 1
}

# native package installation - Arch Linux only
_install_ () {
    if [[ -n "$_packages" ]]; then
        for pak in "${_packages[@]}"; do
            if pacman -Qi "$pak" 2>/dev/null 1>&2; then
                continue
            else
                echo "$PASSWD" | sudo -S pacman -S --noconfirm "$pak"
            fi
        done
        unset _packages
        unset PASSWD
    fi
}

# flatpak installer
_flatpak_ () {
    if [[ -n "$_flatpaks" ]]; then
        for flat in "${_flatpaks[@]}"; do
            flatpak install --or-update --user --noninteractive flathub "$flat"
        done
        unset _flatpaks
    fi
}

# language detect -- add elif for each language in the last if statement
_lang_ () {
    local lang="${LANG:0:2}"
    local available=("pt")
    local ulang=""
    langfile=""

    if [[ " ${available[*]} " == *"$lang"* ]]; then
        ulang="$lang"
    else
        ulang="en"
    fi
    if [ $ulang == "pt" ]; then
        langfile="pt"
    else
        langfile="en"
    fi
}